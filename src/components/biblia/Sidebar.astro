---
import type { EstructuraBiblia } from "../../lib/biblia/types";

interface Props {
	estructura: EstructuraBiblia;
	currentSlug: string;
}

const { estructura, currentSlug } = Astro.props;
---

<aside
	id="sidebar"
	class="fixed md:relative w-72 h-full bg-stone-100 dark:bg-gray-800 border-r border-stone-200 dark:border-gray-700 overflow-y-auto flex-shrink-0 z-50 transform -translate-x-full md:translate-x-0 transition-all duration-300 ease-in-out"
>
	<div class="p-4">
		<div class="flex items-center justify-between mb-4">
			<a href="/" class="text-amber-700 dark:text-amber-400 hover:underline text-sm">&larr; Inicio</a>
			<button
				id="darkModeToggle"
				class="p-2 rounded-lg bg-stone-200 dark:bg-gray-700 hover:bg-stone-300 dark:hover:bg-gray-600 transition-colors"
				aria-label="Cambiar tema"
			>
				<!-- Sol (modo claro) -->
				<svg id="sunIcon" class="w-5 h-5 text-amber-600 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
				</svg>
				<!-- Luna (modo oscuro) -->
				<svg id="moonIcon" class="w-5 h-5 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
				</svg>
			</button>
		</div>
		<h2 class="text-lg font-bold mb-4 text-gray-800 dark:text-gray-100">Sagrada Biblia</h2>

		{Object.entries(estructura).map(([testamentoKey, testamento]) => (
			<div class="mb-6">
				<h3 class="font-bold text-gray-800 dark:text-gray-200 mb-2 text-sm uppercase tracking-wide">
					{testamento.titulo}
				</h3>

				{Object.entries(testamento.secciones).map(([seccionKey, seccion]) => (
					seccion.libros.length > 0 && (
						<div class="mb-3">
							<button
								class="section-toggle w-full flex items-center justify-between text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1 pl-2 pr-2 py-1 hover:bg-stone-200 dark:hover:bg-gray-700 rounded transition"
								data-section={`${testamentoKey}-${seccionKey}`}
							>
								<span>{seccion.titulo}</span>
								<svg class="toggle-icon w-4 h-4 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
								</svg>
							</button>
							<ul class="section-content space-y-1" data-section={`${testamentoKey}-${seccionKey}`}>
								{seccion.libros
									.filter(libro => !libro.data.isIntro && !libro.slug.includes('-comentarios') && !libro.slug.includes('-paralelos'))
									.map(libro => (
										<li>
											<a
												href={`/biblia/${libro.slug}`}
												class:list={[
													"block px-3 py-1.5 text-sm rounded transition",
													libro.slug === currentSlug
														? "bg-amber-200 dark:bg-amber-700 text-amber-900 dark:text-amber-100 font-semibold"
														: "text-gray-600 dark:text-gray-300 hover:bg-amber-100 dark:hover:bg-gray-700 hover:text-amber-800 dark:hover:text-amber-300"
												]}
											>
												{libro.data.title}
											</a>
										</li>
									))}
							</ul>
						</div>
					)
				))}
			</div>
		))}
	</div>
</aside>
