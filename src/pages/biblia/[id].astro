---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export const prerender = true;

export async function getStaticPaths() {
    const blog = await getCollection("blog");
    
    return blog.map((book) => ({
        params: { id: book.slug },
        props: { book }
    }));
}

const { id } = Astro.params;
const { book } = Astro.props;

// Check if book is undefined
if (!book) {
    console.log("Book not found, redirecting to 404");
    return Astro.redirect('/404');
}

const { data, slug, render } = book;
const { title, description, img } = data;

const { Content } = await render();
---

<Layout title={`${title} - Libros`}>
    <div class="flex flex-col md:flex-row gap-12">
        <aside class="flex flex-col items-center gap-4">
            <a href="/" class="hover:underline opacity-70">Volver atr√°s</a>
            <img 
                transition:name={`img-${slug}`} 
                src={`/${img}`} 
                alt={title} 
                class="rounded w-full md:w-72 h-auto"
            />
        </aside>
        <main class="max-w-3xl w-full">
            <h1 class="text-4xl font-bold mb-4">{title}</h1>
            <p class="text-gray-600 mb-6">{description}</p>
            <div class="prose max-w-none">
                <Content />
            </div>
        </main>
    </div>
</Layout>

