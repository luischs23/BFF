---
import { getCollection } from "astro:content";
import BibliaLayout from "../../components/biblia/BibliaLayout.astro";
import { organizarLibrosPorSeccion } from "../../lib/biblia/organizarLibros";

export const prerender = true;

export async function getStaticPaths() {
	const libros = await getCollection("sagrada-biblia");

	return libros.map((book) => ({
		params: { id: book.slug },
		props: { book }
	}));
}

const { id } = Astro.params;
const { book } = Astro.props;

if (!book) {
	return Astro.redirect('/404');
}

const { data, slug, render } = book;
const { title } = data;
const { Content } = await render();

// Obtener todos los libros para el sidebar
const libros = await getCollection('sagrada-biblia');

// Organizar libros por secci√≥n
const estructura = organizarLibrosPorSeccion(libros);
---

<BibliaLayout title={title} slug={slug} estructura={estructura}>
	<Content />
</BibliaLayout>
